<!DOCTYPE html>
<html lang="en"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ryan ♡ Bryce</title>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#f5f5f5;font-family:'Quicksand',sans-serif;color:#333;height:100vh;display:flex;flex-direction:column;overflow:hidden}
header{background:#fff;border-bottom:1px solid #ddd;padding:16px;text-align:center;font-size:1.8em;font-weight:600;position:relative;box-shadow:0 2px 5px rgba(0,0,0,.1)}
#callBtn{position:absolute;right:16px;top:12px;background:#ff6b9d;color:#fff;padding:10px 20px;border-radius:30px;font-size:0.9em;cursor:pointer}
#messages{flex:1;padding:20px;overflow-y:auto;display:flex;flex-direction:column;gap:12px;background:#f9f9f9}
.message{max-width:80%;padding:14px 18px;border-radius:25px;line-height:1.5;align-self:flex-start}
.you{background:#0084ff;color:#fff;align-self:flex-end;border-bottom-right-radius:5px}
.them{background:#e0e0e0;color:#000;align-self:flex-start;border-bottom-left-radius:5px}
.time{font-size:0.8em;color:#888;margin-top:6px;text-align:right}
#inputArea{background:#fff;border-top:1px solid #ddd;padding:12px;display:flex;gap:10px;align-items:center}
#msg{flex:1;padding:16px;border-radius:30px;border:1px solid #ddd;background:#fff;font-size:1.1em}
#sendBtn{background:#0084ff;color:#fff;width:50px;height:50px;border-radius:50%;border:none;font-size:1.6em;cursor:pointer}
#videoCall{position:fixed;inset:0;background:#000;display:none;flex-direction:column;z-index:999}
#remoteVideo{width:100%;height:80%;object-fit:cover}
#localVideo{width:150px;height:200px;position:absolute;bottom:100px;right:20px;border-radius:15px;object-fit:cover;border:4px solid #fff;box-shadow:0 6px 20px rgba(0,0,0,.5)}
#callControls{background:#111;padding:20px;display:flex;justify-content:center;gap:30px}
#hangup{background:#ff4444;color:#fff;padding:16px 40px;border-radius:50px;font-size:1.2em;cursor:pointer}
</style>
</head><body>

<header>Ryan ♡ Bryce</header>
<button id="callBtn" onclick="startCall()">Video Call</button>

<div id="messages"></div>

<div id="inputArea">
  <input type="text" id="msg" placeholder="Type a message...">
  <button id="sendBtn">Send</button>
</div>

<div id="videoCall" class="hidden">
  <video id="remoteVideo" autoplay playsinline></video>
  <video id="localVideo" autoplay playsinline muted></video>
  <div id="callControls">
    <button id="hangup" onclick="endCall()">End Call</button>
  </div>
</div>

<!-- Simple Peer for WebRTC -->
<script src="https://unpkg.com/simple-peer@9.11.1/simplepeer.min.js"></script>

<script>
let name = localStorage.getItem('chatName') || prompt("Ryan or Bryce?", "Ryan");
localStorage.setItem('chatName', name);

// Simple localStorage chat (no Firebase for simplicity)
let chat = JSON.parse(localStorage.getItem('rbChat')||'[]');

function send(){
  const text = document.getElementById('msg').value.trim();
  if(!text) return;
  addMessage(text, name);
  chat.push({n:name,t:text,time:new Date().toLocaleTimeString([],{hour:'numeric',minute:'2-digit'})});
  localStorage.setItem('rbChat',JSON.stringify(chat.slice(-200)));
  document.getElementById('msg').value = '';
}

function addMessage(text, sender){
  const div = document.createElement('div');
  div.className = `message ${sender===name ? 'you' : 'them'}`;
  div.innerHTML = `${text}<div class="time">${new Date().toLocaleTimeString([],{hour:'numeric',minute:'2-digit'})}</div>`;
  document.getElementById('messages').appendChild(div);
  document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
}

// Load chat
chat.forEach(m => addMessage(m.t, m.n));

// Enter = send
document.getElementById('msg').addEventListener('keypress', e => {
  if(e.key === 'Enter') send();
});
document.getElementById('sendBtn').onclick = send;

// WebRTC Video Call (peer-to-peer, no server)
let peer = null;
let localStream = null;

async function startCall(){
  localStream = await navigator.mediaDevices.getUserMedia({video:true, audio:true});
  document.getElementById('localVideo').srcObject = localStream;

  peer = new SimplePeer({initiator:true, stream:localStream, trickle:false});

  peer.on('signal', data => {
    prompt("Copy this code and send to Bryce:", JSON.stringify(data));
  });

  peer.on('stream', stream => {
    document.getElementById('remoteVideo').srcObject = stream;
    document.getElementById('videoCall').classList.remove('hidden');
  });
}

function endCall(){
  if(peer) peer.destroy();
  if(localStream) localStream.getTracks().forEach(track => track.stop());
  document.getElementById('videoCall').classList.add('hidden');
}

// For Bryce to join: paste the code from Ryan
if(confirm("Do you have a call code from Ryan/Bryce?")){
  const code = prompt("Paste the code:");
  if(code){
    localStream = await navigator.mediaDevices.getUserMedia({video:true, audio:true});
    document.getElementById('localVideo').srcObject = localStream;

    peer = new SimplePeer({initiator:false, stream:localStream, trickle:false});
    peer.signal(JSON.parse(code));

    peer.on('signal', data => {
      alert("Send this code back: " + JSON.stringify(data));
    });

    peer.on('stream', stream => {
      document.getElementById('remoteVideo').srcObject = stream;
      document.getElementById('videoCall').classList.remove('hidden');
    });
  }
}
</script>
</body></html>