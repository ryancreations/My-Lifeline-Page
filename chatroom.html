<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ryan ♡ Bryce</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  background:#f5f5f5;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
  height:100vh;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* HEADER */
header{
  background:#fff;
  border-bottom:1px solid #dbdbdb;
  padding:12px;
  text-align:center;
  font-size:1.6em;
  position:relative;
  box-shadow:0 1px 3px rgba(0,0,0,.06);
}

#profileBtn{
  position:absolute;
  right:16px;
  top:12px;
  font-size:1.4em;
  cursor:pointer;
  color:#0095f6;
}

/* CHAT */
#messages{
  flex:1;
  padding:20px 0;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:8px;
}

.message{
  max-width:80%;
  padding:12px 16px;
  border-radius:22px;
  line-height:1.4;
  word-wrap:break-word;
}

.ryan{background:#e0e0e0;align-self:flex-start;border-bottom-left-radius:4px}
.bryce{background:#0084ff;color:#fff;align-self:flex-end;border-bottom-right-radius:4px}

.time{
  font-size:.75em;
  color:#999;
  margin-top:4px;
  text-align:right;
}

/* INPUT */
#inputArea{
  background:#fff;
  border-top:1px solid #dbdbdb;
  padding:10px;
  display:flex;
  gap:10px;
}

#msg{
  flex:1;
  padding:12px 16px;
  border-radius:30px;
  background:#f1f1f1;
  border:none;
  font-size:1.05em;
}

#send{
  background:#0084ff;
  color:#fff;
  width:46px;
  height:46px;
  border-radius:50%;
  border:none;
  cursor:pointer;
}

/* PROFILE MODAL */
#profile{
  position:fixed;
  inset:0;
  background:#fff;
  display:none;
  flex-direction:column;
  align-items:center;
  padding:40px;
  z-index:9999;
}

#profile img{
  width:120px;
  height:120px;
  border-radius:50%;
  border:4px solid #dbdbdb;
  object-fit:cover;
  margin:20px 0;
}

#profile input{
  width:80%;
  padding:12px;
  margin:10px 0;
  border-radius:10px;
  border:1px solid #dbdbdb;
}

#profile button{
  background:#0095f6;
  color:#fff;
  padding:14px 40px;
  border:none;
  border-radius:8px;
  font-size:1.1em;
  margin-top:10px;
  cursor:pointer;
}

#close{
  position:absolute;
  top:20px;
  right:20px;
  font-size:1.8em;
  cursor:pointer;
}
</style>
</head>

<body>

<header id="header">
  Chat
  <span id="profileBtn">⚙️</span>
</header>

<div id="messages"></div>

<div id="inputArea">
  <input id="msg" placeholder="iMessage">
  <button id="send">Send</button>
</div>

<!-- PROFILE -->
<div id="profile">
  <span id="close">×</span>
  <h1>Profile</h1>
  <img id="profilePhoto">
  <input id="profileName" placeholder="Your name">
  <input type="file" id="profileUpload" accept="image/*" hidden>
  <button id="changePhoto">Change Photo</button>
  <button id="saveProfile">Save</button>
</div>

<script>
/* USER */
let name = localStorage.getItem('chatName') || 'Ryan';
localStorage.setItem('chatName', name);

const other = name === 'Ryan' ? 'Bryce' : 'Ryan';
document.getElementById('header').firstChild.textContent = other;

/* SEND */
function send(){
  const msg = document.getElementById('msg');
  if(!msg.value.trim()) return;

  const time = new Date().toLocaleTimeString([],{hour:'numeric',minute:'2-digit'});
  const div = document.createElement('div');
  div.className = `message ${name.toLowerCase()}`;
  div.innerHTML = `${msg.value}<div class="time">${time}</div>`;
  messages.appendChild(div);

  const chat = JSON.parse(localStorage.getItem('rbChat')||'[]');
  chat.push({n:name,t:msg.value,time});
  localStorage.setItem('rbChat',JSON.stringify(chat.slice(-150)));

  msg.value='';
  messages.scrollTop = messages.scrollHeight;
}

/* LOAD CHAT */
(JSON.parse(localStorage.getItem('rbChat')||'[]')).forEach(m=>{
  const div=document.createElement('div');
  div.className=`message ${m.n.toLowerCase()}`;
  div.innerHTML=`${m.t}<div class="time">${m.time}</div>`;
  messages.appendChild(div);
});

/* EVENTS */
send.onclick = send;
msg.onkeypress = e => e.key === 'Enter' && send();

/* PROFILE */
profileBtn.onclick = () => {
  profile.style.display='flex';
  profileName.value = localStorage.getItem('profileName') || other;
  profilePhoto.src = localStorage.getItem('profilePhoto') || 'https://via.placeholder.com/120';
};

close.onclick = () => profile.style.display='none';

changePhoto.onclick = () => profileUpload.click();

profileUpload.onchange = e => {
  const reader=new FileReader();
  reader.onload=ev=>profilePhoto.src=ev.target.result;
  reader.readAsDataURL(e.target.files[0]);
};

saveProfile.onclick = () => {
  localStorage.setItem('profileName',profileName.value);
  localStorage.setItem('profilePhoto',profilePhoto.src);
  profile.style.display='none';
};
</script>
</body>
</html>